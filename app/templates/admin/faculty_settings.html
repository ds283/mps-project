{% import "bootstrap/wtf.html" as wtf %}
{% from "macros.html" import edit_data %}

{% extends "security/index.html" %}

{% block title %}
    Settings
{% endblock %}

{% block formtitle %}
    Edit my settings
{% endblock %}

{% block form_content %}
    <form action="{{ url_for('admin.faculty_settings') }}" method="POST" name="settings_form">

    {{ settings_form.hidden_tag() }}

{#        {{ wtf.form_errors(settings_form) }}#}

    <div class="well">
        {% if data and data.enrollments and data.enrollments.first() %}
            <p>You are currently enrolled for the following project classes</p>
            {% for record in data.enrollments %}
                {% if loop.index > 1 %}
                    <hr class="intro-divider">
                {% endif %}
                {% set pclass = record.pclass %}
                {% set style = pclass.make_CSS_style() %}
                <div class="row vertical-top">
                    <div class="col-xs-6">
                        <a class="btn {% if style %}btn-default{% else %}btn-info{% endif %} btn-table-block"
                           {% if style %}style="{{ style }}"{% endif %}
                           href="mailto:{{ pclass.convenor.email }}">
                            {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                        </a>
                    </div>
                    <div class="col-xs-6">
                        <p>
                            <strong>Supervising:</strong>
                            {% if record.supervisor_state == 1  %}
                                enrolled
                            {% elif record.supervisor_state == 2 %}
                                sabbatical/buyout
                                {% if record.supervisor_reenroll is not none %}
                                    until {{ record.supervisor_reenroll }}
                                {% else %}
                                    (no specified end date)
                                {% endif %}
                            {% elif record.supervisor_state == 3 %}
                                exempt
                            {% else %}
                                unknown state
                            {% endif %}
                        </p>
                        <p>
                            <strong>2nd-marking:</strong>
                            {% if record.marker_state == 1 %}
                                enrolled
                            {% elif record.marker_state == 2 %}
                                sabbatical/buyout
                                {% if record.marker_reenroll is not none %}
                                    until {{ record.marker_reenroll }}
                                {% else %}
                                    (no specified end date)
                                {% endif %}
                            {% elif record.marker_state == 3 %}
                                exempt
                            {% else %}
                                unknown state
                            {% endif %}
                        </p>
                    </div>
                </div>
            {% endfor %}
            {% if data.enrollments.count() != project_classes.count() %}
                <hr class="intro-divider">
                <p>You are not currently enrolled for the following project classes</p>
                <h3>
                    {% for pclass in current_user.get_project_classes() %}
                        {% if not data.is_enrolled(pclass) %}
                            <a class="btn btn-default btn-table-block" href="mailto:{{ pclass.convenor.email }}">
                                {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                            </a>
                        {% endif %}
                    {% endfor %}
                </h3>
            {% endif %}
        {% else %}
            <p>You are not currently enrolled for any project classes.
            The available classes are:</p>
            <h3>
                {% for pclass in project_classes %}
                    <a class="btn btn-default btn-table-block" href="mailto:{{ pclass.convenor.email }}">
                        {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                    </a>
                {% endfor %}
            </h3>
        {% endif %}
    </div>

    {{ wtf.form_field(settings_form.username) }}
    {{ wtf.form_field(settings_form.first_name) }}
    {{ wtf.form_field(settings_form.last_name) }}

    {{ wtf.form_field(settings_form.office) }}
    {{ wtf.form_field(settings_form.academic_title) }}
    {{ wtf.form_field(settings_form.use_academic_title) }}
    {{ wtf.form_field(settings_form.sign_off_students) }}

    {{ wtf.form_field(settings_form.submit, button_map={'submit': 'primary'}) }}

    </form>
{% endblock %}
