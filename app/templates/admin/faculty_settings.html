{% import "bootstrap/wtf.html" as wtf %}
{% from "macros.html" import edit_data %}

{% extends "security/index.html" %}

{% block title %}
    Settings
{% endblock %}

{% block formtitle %}
    Edit my settings
{% endblock %}

{% block form_content %}
    <form action="{{ url_for('admin.faculty_settings') }}" method="POST" name="settings_form">

    {{ settings_form.hidden_tag() }}

{#        {{ wtf.form_errors(settings_form) }}#}

    <div class="well">
        {% if data and data.enrollments and data.enrollments.first() %}
            <p>You are currently enrolled for the following project classes</p>
            <h3>
                {% for record in data.enrollments %}
                    {% set pclass = record.pclass %}
                    {% set style = pclass.make_CSS_style() %}
                    <a class="btn {% if style %}btn-default{% else %}btn-info{% endif %} btn-table-block"
                       {% if style %}style="{{ style }}"{% endif %}
                       href="mailto:{{ pclass.convenor.email }}">
                        {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                    </a>
                {% endfor %}
            </h3>
            {% if data.enrollments.count() != project_classes.count() %}
                <hr class="intro-divider">
                <p>You are not currently enrolled for the following project classes</p>
                <h3>
                    {% for pclass in current_user.get_project_classes() %}
                        {% if not data.is_enrolled(pclass) %}
                            <a class="btn btn-default btn-table-block" href="mailto:{{ pclass.convenor.email }}">
                                {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                            </a>
                        {% endif %}
                    {% endfor %}
                </h3>
            {% endif %}
        {% else %}
            <p>You are not currently enrolled for any project classes.
            The available classes are:</p>
            <h3>
                {% for pclass in project_classes %}
                    <a class="btn btn-default btn-table-block" href="mailto:{{ pclass.convenor.email }}">
                        {{ pclass.name }} ({{ pclass.convenor.build_name() }})
                    </a>
                {% endfor %}
            </h3>
        {% endif %}
    </div>

    {{ wtf.form_field(settings_form.username) }}
    {{ wtf.form_field(settings_form.first_name) }}
    {{ wtf.form_field(settings_form.last_name) }}

    {{ wtf.form_field(settings_form.office) }}
    {{ wtf.form_field(settings_form.academic_title) }}
    {{ wtf.form_field(settings_form.use_academic_title) }}
    {{ wtf.form_field(settings_form.sign_off_students) }}

    {{ wtf.form_field(settings_form.submit, button_map={'submit': 'primary'}) }}

    </form>
{% endblock %}
