{% macro root_dashboard_card(root_dash_data) %}

    {% set config_list, current_year, rollover_ready, matching_ready, rollover_in_progress = root_dash_data %}

    <div class="well">
        <p><span class="dashboard-project-title">System administrator dashboard</span></p>

        <div class="panel panel-primary">
            <div class="panel-heading">Status overview</div>
            <div class="panel-body">
                <div class="row vertical-top root-dashboard-table">
                    <div class="col-xs-3"><strong>Name</strong></div>
                    <div class="col-xs-2"><strong>Convenor</strong></div>
                    <div class="col-xs-2"><strong>Academic year</strong></div>
                    <div class="col-xs-5"><strong>Status</strong></div>
                </div>
                {% for config, capacity, bounded in config_list %}
                    {% set pclass = config.project_class %}
                    <div class="row vertical-top root-dashboard-table">
                        <div class="col-xs-3"><a href="{{ url_for('convenor.overview', id=pclass.id) }}">{{ pclass.name }}</a></div>
                        <div class="col-xs-2"><a href="mailto:{{ pclass.convenor_email }}">{{ pclass.convenor_name }}</a></div>
                        <div class="col-xs-2">{{ config.year }}&ndash;{{ config.year+1 }}</div>
                        <div class="col-xs-5">
                            {% if config.year < current_year %}
                                <span class="label label-danger"><i class="fa fa-check"></i> Rollover available</span>
                            {% endif %}

                            {% set sel_state = config.selector_lifecycle %}
                            {% set sub_state = config.submitter_lifecycle %}
                            {% if sub_state == config.SUBMITTER_LIFECYCLE_PROJECT_ACTIVITY %}
                                <span class="label label-success">Submission period #{{ config.submission_period }}</span>
                            {% elif sub_state == config.SUBMITTER_LIFECYCLE_FEEDBACK_MARKING_ACTIVITY %}
                                <span class="label label-warning">Marking/feedback #{{ config.submission_period }}</span>
                            {% elif sub_state == config.SUBMITTER_LIFECYCLE_READY_ROLLOVER %}
                                <span class="label label-primary">Submissions complete</span>
                            {% else %}
                                <span class="label label-danger">Unknown submitted lifecycle state {{ sub_state }}</span>
                            {% endif %}
                            {% if sel_state == config.SELECTOR_LIFECYCLE_CONFIRMATIONS_NOT_ISSUED %}
                                <span class="label label-default">Confirmations not issued</span>
                            {% elif sel_state == config.SELECTOR_LIFECYCLE_WAITING_CONFIRMATIONS %}
                                <span class="label label-default"><i class="fa fa-times"></i> Not live</span>
                                <span class="label label-primary"><i class="fa fa-clock-o"></i> Confirmations outstanding</span>
                            {% elif sel_state == config.SELECTOR_LIFECYCLE_READY_GOLIVE %}
                                <span class="label label-default">Not live</span>
                                <span class="label label-success"><i class="fa fa-check"></i> GoLive ready</span>
                            {% elif sel_state == config.SELECTOR_LIFECYCLE_SELECTIONS_OPEN %}
                                <span class="label label-primary"><i class="fa fa-check"></i> Selection open</span>
                            {% elif sel_state == config.SELECTOR_LIFECYCLE_READY_MATCHING %}
                                <span class="label label-primary">Selection closed</span>
                                <span class="label label-success"><i class="fa fa-check"></i> Matching ready</span>
                            {% elif sel_state == config.SELECTOR_LIFECYCLE_READY_ROLLOVER %}
                                <span class="label label-primary">Selection closed</span>
                                {% if sub_state == config.SUBMITTER_LIFECYCLE_READY_ROLLOVER and not (config.year < current_year) %}
                                    <span class="label label-success"><i class="fa fa-check"></i> Rollover ready</span>
                                {% else %}
                                    {% if config.do_matching %}
                                        <span class="label label-success"><i class="fa fa-check"></i> Matching selected</span>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                <span class="label label-danger">Unknown selector lifecycle state {{ sel_state }}</span>
                            {% endif %}

                            {% set num_sel = config.number_selectors %}
                            {% set pl = 's' %}
                            {% if num_sel == 1 %}{% set pl = '' %}{% endif %}
                            <span class="label label-info">{{ num_sel }} selector{{ pl }}</span>

                            {% set num_sub = config.number_submitters %}
                            {% set pl = 's' %}
                            {% if num_sub == 1 %}{% set pl = '' %}{% endif %}
                            <span class="label label-info">{{ num_sub }} submitter{{ pl }}</span>

                            {% if sel_state <= config.SELECTOR_LIFECYCLE_READY_GOLIVE %}
                                {% if capacity < num_sel %}
                                    <span class="label label-danger">Capacity {% if not bounded %}>= {% endif %}{{ capacity }}</span>
                                {% elif capacity < 1.15*num_sel %}
                                    <span class="label label-warning">Capacity {% if not bounded %}>= {% endif %}{{ capacity }}</span>
                                {% else %}
                                    <span class="label label-success">Capacity {% if not bounded %}>= {% endif %}{{ capacity }}</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        {% if matching_ready and not rollover_in_progress %}
            <div class="panel panel-warning">
                <div class="panel-heading">Perform automatic matching</div>
                <div class="panel-body">
                    <div class="row vertical-bottom">
                        <div class="col-xs-8">
                            All projects that participate in automatic matching are now ready.
                        </div>
                        <div class="col-xs-4">
                            <div class="pull-right">
                                <a href="{{ url_for('admin.manage_matching') }}" class="btn btn-warning">
                                    Manage matching
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if rollover_ready and not rollover_in_progress %}
            <div class="panel panel-danger">
                <div class="panel-heading">Rollover academic year</div>
                <div class="panel-body">
                    <div class="row vertical-bottom">
                        <div class="col-xs-8">
                            All projects are now in a rollover state.
                        </div>
                        <div class="col-xs-4">
                            <div class="pull-right">
                                <a href="{{ url_for('admin.confirm_global_rollover') }}" class="btn btn-danger">
                                    Rollover academic year
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

{% endmacro %}
