{% extends "convenor/dashboard/dashboard.html" %}

{% block bodyblock %}
    {{ closed_panel(config) }}
    {% if projects and projects.first() %}
        <div class="panel panel-primary panel-primary-bg">
            <div class="panel-heading">Projects attached to <strong>{{ pclass.name }}</strong></div>
            <div class="panel-body">
                <table class="table table-striped table-bordered sortable-pageable">
                    <thead>
                    <tr>
                        <th width="20%"> Name</th>
                        <th width="9%"> Owner</th>
                        <th width="9%"> Status</th>
                        <th width="10%"> Available for</th>
                        <th width="12%"> Affiliation</th>
                        <th width="20%"> Transferable skills</th>
                        <th width="20%"> Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for project in projects %}
                        <tr>
                            {# name #}
                            <td>
                                {% set offerable = project.offerable %}
                                <div class="{% if not offerable %}has-error{% endif %}">
                                    <a href="{{ url_for('faculty.project_preview', id=project.id) }}">
                                        <strong>{{ project.name }}</strong>
                                    </a>
                                    {% if not offerable and project.error %}
                                        <p class="help-block">Warning: {{ project.error }}</p>
                                    {% endif %}
                                </div>
                            </td>

                            {# owner #}
                            <td>
                                <a href="mailto:{{ project.owner.email }}">{{ project.owner.build_name() }}</a>
                            </td>

                            {# status #}
                            <td>
                                {% if offerable %}
                                    {% if project.active %}
                                        Active
                                    {% else %}
                                        Inactive
                                    {% endif %}
                                {% else %}
                                    <strong>Not available</strong>
                                {% endif %}
                            </td>

                            {# project classes #}
                            <td>
                                {% for pclass in project.project_classes %}
                                    <a class="btn btn-info btn-block btn-sm {% if loop.index > 1 %}btn-table-block{% endif %}"
                                       href="mailto:{{ pclass.convenor.email }}">
                                        {{ pclass.abbreviation }} ({{ pclass.convenor.build_name() }})
                                    </a>
                                {% endfor %}
                            </td>

                            {# affiliation #}
                            <td><span class="label label-success">{{ project.group.abbreviation }}</span></td>

                            {# transferable skills #}
                            <td>
                                {% for skill in project.skills %}
                                    {% if skill.active %}
                                        <span class="label label-default">{{ skill.name }}</span>
                                    {% endif %}
                                {% endfor %}
                            </td>

                            {# actions #}
                            <td>
                                <div class="dropdown">
                                    <button class="btn btn-success btn-sm btn-block dropdown-toggle" type="button"
                                            data-toggle="dropdown">
                                        Actions
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="{{ url_for('convenor.edit_project', id=project.id, pclass_id=pclass.id) }}">
                                                <i class="fa fa-pencil"></i> Edit project
                                            </a>
                                        </li>
                                        <li>
                                            <a href="{{ url_for('faculty.project_preview', id=project.id) }}">
                                                Preview web page
                                            </a>
                                        </li>

                                        <li>
                                            <a href="{{ url_for('convenor.attach_skills', id=project.id, pclass_id=pclass.id) }}">
                                                <i class="fa fa-pencil"></i> Transferable skills
                                            </a>
                                        </li>

                                        <li>
                                            <a href="{{ url_for('convenor.attach_programmes', id=project.id, pclass_id=pclass.id) }}">
                                                <i class="fa fa-pencil"></i> Degree programmes
                                            </a>
                                        </li>

                                        <li>
                                            {% if project.active %}
                                                <a href="{{ url_for('convenor.deactivate_project', id=project.id, pclass_id=pclass.id) }}">
                                                    Make inactive
                                                </a>
                                            {% else %}
                                                <a href="{{ url_for('convenor.activate_project', id=project.id, pclass_id=pclass.id) }}">
                                                    Make active
                                                </a>
                                            {% endif %}
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div style="text-align: center;">
    {% else %}
        <div style="text-align: center;">
        <h3> No projects currently attached to <span class="label label-default">{{ pclass.name }}</span></h3>
        <hr class="intro-divider">
    {% endif %}
    <a href="{{ url_for('convenor.add_project', pclass_id=pclass.id) }}" class="btn btn-default btn-lg">
        <i class="fa fa-plus"></i>
        Add new project
    </a>
    </div>
{% endblock %}
