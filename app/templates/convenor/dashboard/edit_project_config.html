{% import "bootstrap/form.html" as wtf %}

{% extends "security/index.html" %}

{% macro show_default_field(field, default_value) %}
    {% if field.flags.required and not required in kwargs %}
        {% set kwargs = dict(required=True, **kwargs) %}
    {% endif %}

    {% set extra_classes = ' ' + field.render_kw.class if field.render_kw.class else '' %}

    <div class="form-group {%- if field.flags.required %} require{% endif -%}">
        {{ field.label(class="control-label")|safe }}
        <div class="input-group">
            {% if field.errors %}
                {{ field(class="form-control mb-2 mb-sm-0 is-invalid%s" % extra_classes, **kwargs)|safe }}
            {% else %}
                {{ field(class="form-control mb-2 mb-sm-0%s" % extra_classes, **kwargs)|safe }}
            {% endif %}
            <div class="input-group-append">
                <span class="input-group-text">Current default&nbsp;<strong>{{ default_value }}</strong></span>
            </div>
        </div>
        {% if field.errors %}
            {% for error in field.errors %}
                <p class="help-block">{{ error }}</p>
            {% endfor %}
        {% elif field.description %}
            <p class="help-block">{{ field.description|safe }}</p>
        {% endif %}
    </div>
{% endmacro %}

{% block title %}
    Edit project configuration
{% endblock %}

{% block formtitle %}
    Edit project configuration for academic year <strong>{{ config.year }}&ndash;{{ config.year+1 }}</strong>
{% endblock %}

{% block form_content %}
    <form action="{{ url_for('convenor.edit_project_config', pid=config.id) }}" method="POST" name="edit_form">

        {{ form.hidden_tag() }}

{#        {{ wtf.form_errors(form) }}#}

        <div class="card mt-3 mb-3 card-body bg-well">
            {{ wtf.render_field(form.skip_matching) }}
            {{ wtf.render_field(form.requests_skipped) }}
            <hr class="intro-divider">
            {{ wtf.render_field(form.full_CATS) }}
        </div>

        <div class="card mt-3 mb-3 card-body bg-well">
            {{ show_default_field(form.CATS_supervision, config.project_class.CATS_supervision) }}
            {{ show_default_field(form.CATS_marking, config.project_class.CATS_marking) }}
            {{ show_default_field(form.CATS_presentation, config.project_class.CATS_presentation) }}
        </div>

        {{ wtf.render_field(form.submit, button_map={'submit': 'primary'}) }}

    </form>
{% endblock %}
