{% from "icon_block.html" import icon_block %}

{% macro selection_closed(config, rollover_in_progress) %}
    <div class="card border-secondary mt-3 mb-3">
        <div class="card-header"><strong>Student selections are now closed</strong></div>
        <div class="card-body">
            {% set selector_data = config.selector_data %}
            {% set submitted = selector_data['have_submitted'] %}
            {% set missing = selector_data['missing'] %}
            {% set total = selector_data['total'] %}
            <div>
                {% if submitted == total %}
                    <div class="alert alert-success">
                        {% call icon_block("check-circle") %}
                            <div><strong>All students submitted validated choices before selection closed.</strong></div>
                        {% endcall %}
                    </div>
                {% else %}
                    {% if missing == 0 %}
                        <div class="alert alert-success">
                            {% call icon_block("check-circle") %}
                                <div><strong>Some students did not submit validated choices, but all students had bookmark data.</strong></div>
                            {% endcall %}
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            {% call icon_block("exclamation-circle") %}
                                <div><strong>Some students did not submit validated choices. Of these, some students did not have valid bookmark lists.</strong></div>
                                <div class="mt-1">
                                    These students may optionally be allocated an arbitrary project
                                    during automated matching.
                                </div>
                            {% endcall %}
                        </div>
                    {% endif %}
                    {% if config.selection_open_to_all %}
                        <div class="alert alert-info">
                            {% call icon_block("info-circle") %}
                                <div><strong>Selection for this project was available to all eligible students on an opt-in basis.</strong></div>
                                <div class="mt-1">
                                    Students who have not submitted a validated selection
                                    will be assumed not to have opted-in and will be ignored when performing
                                    automatic matching.
                                </div>
                            {% endcall %}
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            {% call icon_block("info-circle") %}
                                <div><strong>Where students did not submit validated choices, their bookmark lists (if valid) have been converted into submission data.</strong></div>
                                <div class="mt-1">
                                    These choices may optionally be down-weighted
                                    during matching in order to prioritize rankings from students who
                                    submitted a correct list of choices.
                                </div>
                            {% endcall %}
                        </div>
                    {% endif %}
                {% endif %}
            </div>
            <div class="d-flex flex-row justify-content-start align-items-start gap-2 mt-2">
                <div class="list-group">
                    <div class="list-group-item {% if submitted == total %}list-group-item-success{% else %}list-group-item-secondary{% endif %}">
                        Selectors with ranking
                        <a class="text-decoration-none" href="{{ url_for('convenor.selectors', id=config.project_class.id, state_filter='submitted') }}">(Show...)</a>
                        <span class="badge bg-secondary rounded-pill">{{ submitted }}/{{ total }}</span>
                    </div>
                </div>
                <div class="list-group">
                    <div class="list-group-item {% if missing > 0 %}list-group-item-danger{% else %}list-group-item-success{% endif %}">
                        Selectors missing data
                        <a class="text-decoration-none" href="{{ url_for('convenor.selectors', id=config.project_class.id, state_filter='none') }}">(Show...)</a>
                        <span class="badge bg-secondary rounded-pill">{{ missing }}/{{ total }}</span>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-row justify-content-start align-items-start gap-2 mt-2">
                <a class="text-decoration-none" href="{{ url_for('convenor.selector_grid', id=config.pclass_id) }}">
                    Show selector grid ...
                </a>
            </div>
        </div>
    </div>
{% endmacro %}
