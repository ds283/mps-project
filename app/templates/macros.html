{% macro truncate(name) %}
    {% if name|length > 20 %}
        {{ name[0:20] }}...
    {% else %}
        {{ name }}
    {% endif %}
{% endmacro %}

{% macro edit_data(item) %}
    {% if item and (item.created_by or item.last_edited_by) %}
        <hr class="intro-divider">
        <div class="panel panel-default">
            <div class="panel-heading">History</div>
            <div class="panel-body">
                {% if item.created_by %}
                    <p>
                        Created by {{ item.created_by.build_name_and_username() }}
                        {% if item.creation_timestamp %}
                            on {{ item.creation_timestamp.strftime("%a %d %b %Y %H:%M:%S") }}
                        {% endif %}
                    </p>
                {% endif %}
                {% if item.last_edited_by %}
                    <p>
                        Last edited by {{ item.last_edited_by.build_name_and_username() }}
                        {% if item.last_edit_timestamp %}
                            on {{ item.last_edit_timestamp.strftime("%a %d %b %Y %H:%M:%S") }}
                        {% endif %}
                    </p>
                {% endif %}
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% macro message_card(message, enrolled_classes) %}
    <div class="well">
        <div class="row vertical-top" style="margin-bottom: 1%;">
            <div class="col-xs-5">
                {% if message.title|length > 0 %}
                    <strong>{{ message.title }}</strong>
                {% endif %}
            </div>
            <div class="col-xs-7">
                <div class="pull-right">
                    {% if enrolled_classes %}
                        {% for pclass in message.project_classes %}
                            {% if pclass in enrolled_classes %}
                                <span class="label label-info">{{ pclass.name }}</span>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                {{ message.body }}
            </div>
        </div>
        <hr class="intro-divider">
        <div class="row">
            <div class="col-xs-9">
                Posted by <a href="mailto:{{ message.user.email }}">{{ message.user.build_name() }}</a>
                at {{ message.issue_date.strftime("%a %d %b %Y %H:%M:%S") }}
            </div>
            <div class="col-xs-3">
                {% if message.dismissible %}
                    <div class="pull-right">
                        <a href="{{ url_for('admin.dismiss_message', id=message.id) }}" class="btn btn-default">Don't show again</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}
