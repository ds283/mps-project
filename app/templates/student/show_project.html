{% import "bootstrap/wtf.html" as wtf %}

{% extends "base_project.html" %}

{% block scripts %}
    {{ super() }}
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>
{% endblock %}

{% block title %}
    {{ title }}
{% endblock %}

{% block content %}
    <div class="container-fluid main-content bg-project">
        <br/>
        <div class="row">
            <div class="col-xs-2"></div>
            <div class="col-xs-8">
                <div class="row sm-gap-below">
                    <div class="col-xs-12 project-title">
                        {{ title }}
                    </div>
                </div>
                <div class="row sm-gap-below">
                    <div class="col-xs-6 project-owner-name">
                        {{ project.owner.build_name() }}
                    </div>
                    <div class="col-xs-6">
                        <div class="pull-right">
                            {% if project.group  %}
                                <div class="research-group-banner">{{ project.group.name }}</div>
                                {% if project.group.website and project.group.website is not none %}
                                    <a class="research-group-webpage" href="http://{{ project.group.website }}">
                                        Research group website <i class="fa fa-external-link"></i>
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                <hr class="intro-divider">

                <div class="panel panel-primary panel-primary-bg">
                    <div class="panel-heading">Project details</div>
                    <div class="panel-body">
                        <div class="panel panel-default ataglance-background">
                            <div class="panel-heading">
                                <div class="row vertical-align">
                                    <div class="col-xs-4">
                                        Key facts
                                    </div>
                                    <div class="col-xs-8">
                                        {% if sel and sel.config.open %}
                                            <div class="pull-right">
                                                {% if sel.bookmarks.filter_by(liveproject_id=project.id).first() %}
                                                    <a href="{{ url_for('student.remove_bookmark', sid=sel.id, pid=project.id) }}" class="btn btn-default btn-sm">
                                                        Remove bookmark
                                                    </a>
                                                {% else %}
                                                    <a href="{{ url_for('student.add_bookmark', sid=sel.id, pid=project.id) }}" class="btn btn-default btn-sm">
                                                        Add bookmark
                                                    </a>
                                                {% endif %}
                                                {% if not project.is_available(sel) %}
                                                    {% if sel in project.confirm_waiting %}
                                                        <a href="{{ url_for('student.cancel_confirmation', sid=sel.id, pid=project.id) }}" class="btn btn-warning btn-sm">
                                                            Cancel meeting confirmation request
                                                        </a>
                                                    {% else %}
                                                        <a href="{{ url_for('student.request_confirmation', sid=sel.id, pid=project.id) }}" class="btn btn-success btn-sm">
                                                            Request meeting confirmation
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div class="container-fluid">
                                    {# show sign-up details if being viewed by a live student #}
                                    {% if sel %}
                                        <div class="row vertical-top">
                                            <div class="col-xs-3">Sign-up details</div>
                                            <div class="col-xs-9">
                                                <div class="sm-gap-below">
                                                    {% if project.meeting_reqd == project.MEETING_REQUIRED %}
                                                        <span class="label label-danger project-label">Meeting required</span>
                                                    {% elif project.meeting_reqd == project.MEETING_OPTIONAL %}
                                                        <span class="label label-warning project-label">Meeting optional</span>
                                                    {% else %}
                                                        <span class="label label-default project-label">Meeting not required</span>
                                                    {% endif %}
                                                    {% if project.is_available(sel) %}
                                                        <span class="label label-success project-label">Available</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {% if keywords and keywords|length > 0 %}
                                        <div class="row sm-gap-below vertical-top">
                                            <div class="col-xs-3">Subject keywords</div>
                                            <div class="col-xs-9">
                                                {% for keyword in keywords %}
                                                    <span class="label label-success project-label">{{ keyword }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}

                                    {% if project.skills and project.skills.first() %}
                                        <div class="row sm-gap-below vertical-top">
                                            <div class="col-xs-3">Transferable skills</div>
                                            <div class="col-xs-9">
                                                {% for skill in project.skills %}
                                                    <span class="label label-info project-label">{{ skill.name }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}

                                    {% if project.programmes and project.programmes.first() %}
                                        <div class="row sm-gap-below vertical-top">
                                            <div class="col-xs-3">Prefer degree programmes</div>
                                            <div class="col-xs-9">
                                                {% for programme in project.programmes %}
                                                    {% if programme.active %}
                                                        <span class="label label-default project-label">{{ programme.name }} {{ programme.degree_type.name }}</span>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}

                                    <div class="row vertical-top">
                                        <div class="col-xs-3">Supervision team</div>
                                        <div class="col-xs-9">
                                            {% for role in project.team %}
                                                <span class="label label-default project-label">{{ role.name }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h4>Description</h4>
                        <div class="project-description">{{ project.description|markdown|bclean|blinkify|safe }}</div>

                        {% if project.reading and project.reading is not none %}
                            <div class="panel panel-default">
                                <div class="panel-heading">Recommended reading</div>
                                <div class="panel-body">{{ project.reading|markdown|bclean|blinkify|safe }}</div>
                            </div>
                        {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-2"></div>
        </div>
    </div>
    <nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
        <div class="navbar-header footer-bar">
            <p class="copyright text-muted small">Copyright (c) 2018 University of Sussex</p>
        </div>
    </nav>
{% endblock %}
